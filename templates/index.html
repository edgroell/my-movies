<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Movies</title>
    <!-- Removed Tailwind CSS CDN -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="main-container">
        <h1 class="page-title">My Movies</h1>

        <!-- User List Display -->
        <div class="user-list-section section-separator">
            <h2 class="section-title">Existing Users</h2>
            <div class="user-list-container">
                <!-- Jinja2 loop to display users passed from the Flask backend -->
                {% if users %}
                    <ul class="user-list">
                        {% for user in users %}
                            <li class="list-item user-item-actions">
                                <!-- Clickable link to user's movies -->
                                <a href="{{ url_for('user_movies', user_id=user.id) }}" class="user-link">
                                    <span class="list-item-text">Movies from {{ user.username }}</span>
                                </a>
                                <div class="user-actions">
                                    <!-- Update User Form - now points to update_user_details -->
                                    <form action="{{ url_for('update_user_details', user_id=user.id) }}" method="POST" class="inline-form">
                                        <input type="text" name="new_username" placeholder="New Username" class="form-input-small" required>
                                        <button type="submit" class="action-button update-button">Update</button>
                                    </form>
                                    <!-- Delete User Form -->
                                    <form action="{{ url_for('delete_user', user_id=user.id) }}" method="POST" class="inline-form delete-form-margin">
                                        <button type="submit" class="action-button delete-button">Delete</button>
                                    </form>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="no-users-message">No users found. Be the first to create one!</p>
                {% endif %}
            </div>
        </div>

        <!-- Add New User Form -->
        <div class="add-user-form">
            <h2 class="section-title form-title">Add New User</h2>
            <form action="{{ url_for('create_user') }}" method="POST" class="form-layout">
                <div class="form-group">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" id="username" name="username" required
                           class="form-input">
                </div>
                <button type="submit" class="submit-button">
                    Add User
                </button>
                <!-- Display messages from Flask's flash system -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        <div class="message-box">
                            {% for category, message in messages %}
                                <p class="
                                    {% if category == 'success' %}message-success
                                    {% elif category == 'error' %}message-error
                                    {% else %}message-info
                                    {% endif %}
                                ">{{ message }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}
            </form>
        </div>

    </div>
</body>
</html>
